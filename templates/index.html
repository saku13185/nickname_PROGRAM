{% extends "base.html" %}

{% block title %}분석 결과{% endblock %}

{% block content %}
<h1 class="mb-4 text-center">📊 날씨 모델 분석 대시보드</h1>
<hr class="mb-5">

<div class="row mb-5">
    <div class="col-12">
        <div class="card shadow border-info">
            <div class="card-body d-flex justify-content-between align-items-center p-4">
                <h4 class="card-title mb-0 text-info">최신 분석 실행</h4>
                <form action="{{ url_for('run_analysis') }}" method="post">
                    <button type="submit" class="btn btn-info btn-lg text-white analysis-btn">
                        <i class="bi bi-play-circle"></i> 날씨 데이터 분석 시작
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

{% if analysis_status %}
<div class="alert alert-success text-center fw-bold" role="alert">
    ✅ 분석 기간: 최근 31일 관측 (KMA) + 예측 1일 (OpenMeteo) 결과입니다.
</div>

<div class="card shadow-lg mb-5 analysis-section">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">📈 모델 예측값 시계열 비교</h4>
    </div>
    <div class="card-body p-4">
        <p class="text-muted text-center mb-4">기간: 2025-10-03 ~ 2025-10-09 (하드코딩된 기간)</p>
        {% if plot_images %}
            <img src="{{ plot_images[0] }}" class="img-fluid border rounded" alt="Weather Comparison Plot">
        {% else %}
            <p class="text-center text-danger">시각화 그래프를 불러올 수 없습니다. 기간 설정을 확인하거나 데이터가 충분한지 확인하세요.</p>
        {% endif %}
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card shadow-lg mb-5 analysis-section">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">🎯 모델 정확도 지표 (vs KMA 관측값)</h4>
            </div>
            <div class="card-body p-4">
                <p class="text-muted small">RMSE/MAE는 **낮을수록**, Corr (R)은 **1에 가까울수록** 정확합니다.</p>
                {% if accuracy_html %}
                    <div class="table-responsive">
                        {{ accuracy_html | safe }}
                    </div>
                {% else %}
                    <p class="text-center">KMA 관측 데이터가 없어 정확도 비교를 수행하지 못했습니다.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card shadow-lg mb-5 analysis-section">
    <div class="card-header bg-secondary text-white">
        <h4 class="mb-0">📋 모델별 예측 통계 요약</h4>
    </div>
    <div class="card-body p-4">
        {% if summary_html %}
            <div class="table-responsive">
                {{ summary_html | safe }}
            </div>
        {% else %}
            <p class="text-center">모델별 통계 요약 데이터를 불러올 수 없습니다.</p>
        {% endif %}
    </div>
</div>

<div class="card shadow-lg mb-5 analysis-section">
    <div class="card-header bg-dark text-white">
        <h4 class="mb-0">📄 상세 분석 보고서 (텍스트 로그)</h4>
    </div>
    <div class="card-body p-4">
        <pre class="report-section">{{ report_text }}</pre>
    </div>
</div>

{% else %}
<div class="alert alert-warning text-center p-5 mt-5" role="alert">
    <h3 class="mb-3">분석 준비 완료</h3>
    <p class="lead">데이터 분석 결과를 확인하려면 위에 있는 **"날씨 데이터 분석 시작"** 버튼을 눌러주세요.</p>
</div>

{% endif %}

{% endblock %}
